<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wedding RSVP</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&display=swap');
        .font-serif { font-family: 'Playfair Display', serif; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // ========================================
        // COUPLE'S PHOTO - Add your photo URL hereh
        // ========================================
        const COUPLE_PHOTO_URL = 'couple-photo.jpg';

        // ========================================
        // WEDDING & RECEPTION SLOTS
        // ========================================
        const TOTAL_WEDDING_SLOTS = 45;
        
        // Pre-allocated attendees (automatically attending wedding & reception)
        const PRE_ALLOCATED_ATTENDEES = [
            { name: 'Delilah Malabanan', groupId: 'delilah-group' },
            { name: 'John Drew Malabanan', groupId: 'delilah-group' },
            { name: 'Fe Zamora', groupId: 'fe-group' },
            { name: 'Donato dela Luna', groupId: 'donato-group' },
            { name: 'Evelyn dela Luna', groupId: 'donato-group' },
            { name: 'Joshua Malabanan', groupId: 'joshua-group' },
            { name: 'Genel Malabanan', groupId: 'joshua-group' },
            { name: 'Roderick Malabanan', groupId: 'roderick-group' },
            { name: 'Ana Santos', groupId: 'ana-group' },
            { name: 'Mike Schultz', groupId: 'hannah-group' },
            { name: 'Hannah Olib-Schultz', groupId: 'hannah-group' },
            { name: 'Raul Mendejar', groupId: 'hannah2-group' },
            { name: 'Hannah Zamora-Mendejar', groupId: 'hannah2-group' },
            { name: 'Joseph Garibay', groupId: 'joseph-group' },
            { name: 'Jonathan de Belen', groupId: 'jonathan2-group' },
            { name: 'Lyra dela Luna', groupId: 'donato-group' },
            { name: 'Jonathan Roy Perilla', groupId: 'jonathan-group' },
            { name: 'Fatima dela Luna', groupId: 'dennis-group' },
            { name: 'Zany Jay Perilla', groupId: 'zany-group' },
            { name: 'Julia Arabela Malabanan', groupId: 'joshua-group' },
            { name: 'Maria Malabanan', groupId: 'maria-group' },
            { name: 'Victoria dela Luna', groupId: 'victoria-group' },
            { name: 'Naomi Perilla', groupId: 'naomi-group' }
        ];

        // ========================================
        // GUEST DATA
        // ========================================
        const GUEST_DATA = {
            'ND/C4WB6': {
                groupId: 'delilah-group',
                primaryGuest: 'Delilah Malabanan',
                additionalGuests: ['John Drew Malabanan'],
                maxGuests: 2
            },
            'UZH9%V9A': {
                groupId: 'maria-group',
                primaryGuest: 'Maria Malabanan',
                additionalGuests: [],
                maxGuests: 1
            },
            'A6+X)YEV': {
                groupId: 'glenn-group',
                primaryGuest: 'Glenn Malabanan',
                additionalGuests: [],
                maxGuests: 4
            },
            'ZD8]/K-M': {
                groupId: 'joshua-group',
                primaryGuest: 'Joshua Malabanan',
                additionalGuests: ['Genel Malabanan', 'Julia Arabela Malabanan'],
                maxGuests: 5
            },
            '=Z6WVP.M': {
                groupId: 'marilou-group',
                primaryGuest: 'Marilou Malabanan',
                additionalGuests: [],
                maxGuests: 3
            },
            'S6ZP}!-N': {
                groupId: 'victoria-group',
                primaryGuest: 'Victoria dela Luna',
                additionalGuests: [],
                maxGuests: 1
            },
            '?>FV+FS2': {
                groupId: 'carlo-group',
                primaryGuest: 'Carlo Mendoza',
                additionalGuests: [],
                maxGuests: 2
            },
            '{YMEB2F]': {
                groupId: 'donato-group',
                primaryGuest: 'Donato dela Luna',
                additionalGuests: ['Evelyn dela Luna', 'Lyra dela Luna'],
                maxGuests: 5
            },
            'Q45ZV!-)': {
                groupId: 'dolores-group',
                primaryGuest: 'Dolores Dela Luna',
                additionalGuests: [],
                maxGuests: 5
            },
            'DXKR28=?': {
                groupId: 'dennis-group',
                primaryGuest: 'Dennis Dela Luna',
                additionalGuests: ['Fatima dela Luna'],
                maxGuests: 3
            },
            'XC{R7AWQ': {
                groupId: 'ana-group',
                primaryGuest: 'Ana Santos',
                additionalGuests: [],
                maxGuests: 2
            },
            'MN}JE8V^': {
                groupId: 'roderick-group',
                primaryGuest: 'Roderick Malabanan',
                additionalGuests: [],
                maxGuests: 2
            },
            '5^W?Z8HR': {
                groupId: 'kitty-group',
                primaryGuest: 'Kitty Amante',
                additionalGuests: [],
                maxGuests: 2
            },
            '8N>T@55{': {
                groupId: 'oshean-group',
                primaryGuest: 'Oshean Garonita',
                additionalGuests: [],
                maxGuests: 1
            },
            ']EW^5BSF': {
                groupId: 'princess-group',
                primaryGuest: 'Princess Castillo',
                additionalGuests: [],
                maxGuests: 1
            },
            ')M{5W&RZ': {
                groupId: 'nova-group',
                primaryGuest: 'Nova Regalario',
                additionalGuests: [],
                maxGuests: 1
            },
            '}$GG[8JA': {
                groupId: 'nathalia-group',
                primaryGuest: 'Nathalia Palma',
                additionalGuests: [],
                maxGuests: 1
            },
            '[2DY2Z(F': {
                groupId: 'mimi-group',
                primaryGuest: 'Mimi Hori',
                additionalGuests: [],
                maxGuests: 2
            },
            '&?H[E2]_': {
                groupId: 'saniata-group',
                primaryGuest: 'Saniata Corpuz',
                additionalGuests: [],
                maxGuests: 1
            },
            'N7{FTM-P': {
                groupId: 'clarissa-group',
                primaryGuest: 'Clarissa Sumagaysay',
                additionalGuests: [],
                maxGuests: 2
            },
            'Q4J!5FHU': {
                groupId: 'clydinne-group',
                primaryGuest: 'Clydinne Vargas',
                additionalGuests: [],
                maxGuests: 1
            },
            'YVW6>J{W': {
                groupId: 'jewelle-group',
                primaryGuest: 'Jewelle Santos',
                additionalGuests: [],
                maxGuests: 1
            },
            'NFSWG/6L': {
                groupId: 'kristine-group',
                primaryGuest: 'Kristine Escaner',
                additionalGuests: [],
                maxGuests: 1
            },
            '/F[G8P+H': {
                groupId: 'abby-group',
                primaryGuest: 'Abby Rasalan',
                additionalGuests: [],
                maxGuests: 1
            },
            '8PFNVGP]': {
                groupId: 'fe-group',
                primaryGuest: 'Fe Zamora',
                additionalGuests: [],
                maxGuests: 1
            },
            'BPA5Z6^X': {
                groupId: 'naomi-group',
                primaryGuest: 'Naomi Perilla',
                additionalGuests: [],
                maxGuests: 1
            },
            '*C=R57SC': {
                groupId: 'feena-group',
                primaryGuest: 'Feena Grace Perilla-Encarnacion',
                additionalGuests: [],
                maxGuests: 4
            },
            '>EYF4VA?': {
                groupId: 'jonathan-group',
                primaryGuest: 'Jonathan Roy Perilla',
                additionalGuests: [],
                maxGuests: 4
            },
            '{SBC)L5{': {
                groupId: 'zany-group',
                primaryGuest: 'Zany Jay Perilla',
                additionalGuests: [],
                maxGuests: 3
            },
            'XZW$X9AR': {
                groupId: 'joseph-group',
                primaryGuest: 'Joseph Garibay',
                additionalGuests: [],
                maxGuests: 3
            },
            ']G9Z}>=H': {
                groupId: 'jonathan2-group',
                primaryGuest: 'Jonathan de Belen',
                additionalGuests: [],
                maxGuests: 1
            },
            '2/RC7J}9': {
                groupId: 'sara-group',
                primaryGuest: 'Sara Isabelle Pacia',
                additionalGuests: [],
                maxGuests: 2
            },
            'BBWZM8S&': {
                groupId: 'dan-group',
                primaryGuest: 'Dan Paurom',
                additionalGuests: [],
                maxGuests: 1
            },
            'BRG3%F-B': {
                groupId: 'don-group',
                primaryGuest: 'Don Lejano',
                additionalGuests: [],
                maxGuests: 1
            },
            '8=UX!T]R': {
                groupId: 'catherine-group',
                primaryGuest: 'Catherine Miranda',
                additionalGuests: [],
                maxGuests: 1
            },
            '[W=NP-9B': {
                groupId: 'hannah-group',
                primaryGuest: 'Hannah Olib-Schultz',
                additionalGuests: ['Mike Schultz'],
                maxGuests: 2
            },
            'EQ^M-4Q2': {
                groupId: 'hannah2-group',
                primaryGuest: 'Hannah Zamora-Mendejar',
                additionalGuests: ['Raul Mendejar'],
                maxGuests: 4
            },
            'GXU6$=8U': {
                groupId: 'ianthe-group',
                primaryGuest: 'Ianthe Monica Carlos',
                additionalGuests: [],
                maxGuests: 1
            },
            'A(RS77YB': {
                groupId: 'via-group',
                primaryGuest: 'Via Marie Cabel',
                additionalGuests: [],
                maxGuests: 1
            },
            'F3HYB%5H': {
                groupId: 'alexis-group',
                primaryGuest: 'Alexis Valde',
                additionalGuests: [],
                maxGuests: 1
            }
        };

        // Helper function to check if guest is pre-allocated
        const isPreAllocated = (guestName, groupId) => {
            return PRE_ALLOCATED_ATTENDEES.some(
                attendee => attendee.name === guestName && attendee.groupId === groupId
            );
        };

        // Storage implementation - GOOGLE SHEETS VERSION
        const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwmiXuQucxhiQ1Brep6_s8oDiRxBQYm5pRS2WxEGfxyxkzI-uDNkq_awYBgLybeJAgFcQ/exec'; // Paste your deployed URL
        
        window.storage = {
            async get(key, shared = false) {
                const storageKey = shared ? `shared_${key}` : key;
                
                // Try to fetch from Google Sheets first
                if (key.startsWith('rsvp:')) {
                    try {
                        const groupId = key.replace('rsvp:', '');
                        const response = await fetch(`${APPS_SCRIPT_URL}?groupId=${groupId}`, {
                            method: 'GET',
                            redirect: 'follow'
                        });
                        
                        if (response.ok) {
                            const data = await response.json();
                            if (data && data.groupId) {
                                return { key, value: JSON.stringify(data), shared };
                            }
                        }
                    } catch (err) {
                        console.log('Falling back to localStorage:', err);
                    }
                }
                
                // Fallback to localStorage
                const data = localStorage.getItem(storageKey);
                return data ? { key, value: data, shared } : null;
            },
            
            async set(key, value, shared = false) {
                const storageKey = shared ? `shared_${key}` : key;
                
                // Save to localStorage
                localStorage.setItem(storageKey, value);
                
                // Also send to Google Sheets
                if (key.startsWith('rsvp:')) {
                    try {
                        const rsvpData = JSON.parse(value);
                        const response = await fetch(APPS_SCRIPT_URL, {
                            method: 'POST',
                            mode: 'no-cors', // Required for Google Apps Script
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(rsvpData),
                            redirect: 'follow'
                        });
                        
                        // Note: no-cors mode means we can't read the response,
                        // but the data will still be saved
                        console.log('RSVP sent to Google Sheets');
                        
                    } catch (err) {
                        console.error('Error syncing to Google Sheets:', err);
                        // Data is still in localStorage
                    }
                }
                
                return { key, value, shared };
            },
            
            async list(prefix, shared = false) {
                const keys = [];
                const storagePrefix = shared ? `shared_${prefix}` : prefix;
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key.startsWith(storagePrefix)) {
                        keys.push(key.replace(storagePrefix, ''));
                    }
                }
                return keys;
            }
        };

        const Heart = ({ className }) => (
            <svg className={className} fill="currentColor" viewBox="0 0 24 24">
                <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
            </svg>
        );

        function WeddingRSVP() {
            const [stage, setStage] = useState('password');
            const [password, setPassword] = useState('');
            const [error, setError] = useState('');
            const [guestGroup, setGuestGroup] = useState(null);
            const [guests, setGuests] = useState([]);
            const [submitted, setSubmitted] = useState(false);
            const [loading, setLoading] = useState(false);
            const [isEditing, setIsEditing] = useState(false);
            const [weddingSlotsFilled, setWeddingSlotsFilled] = useState(23); // Pre-allocated

            useEffect(() => {
                calculateWeddingSlots();
            }, []);

            const calculateWeddingSlots = async () => {
                try {
                    // Try Google Sheets API first
                    const response = await fetch(`${APPS_SCRIPT_URL}?action=slots`, {
                        method: 'GET',
                        redirect: 'follow'
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        setWeddingSlotsFilled(data.filled);
                        return;
                    }
                } catch (err) {
                    console.log('Using localStorage fallback for slots');
                }
                
                // Fallback to original localStorage calculation
                let count = 20;
                const keys = await window.storage.list('rsvp:', true);
                // ... rest of your existing code
            };

            const handlePasswordSubmit = async () => {
                const upperPassword = password.toUpperCase().trim();
                
                if (GUEST_DATA[upperPassword]) {
                    const data = GUEST_DATA[upperPassword];
                    setGuestGroup(data);
                    
                    try {
                        const existing = await window.storage.get(`rsvp:${data.groupId}`, true);
                        
                        if (existing) {
                            const existingData = JSON.parse(existing.value);
                            setGuests(existingData.guests);
                            setIsEditing(true);
                        } else {
                            const initialGuests = [];
                            
                            // Add primary guest
                            const isPrimaryPreAllocated = isPreAllocated(data.primaryGuest, data.groupId);
                            initialGuests.push({
                                name: data.primaryGuest,
                                attending: isPrimaryPreAllocated ? true : null,
                                attendanceType: isPrimaryPreAllocated ? 'both' : 'both',
                                isPrimary: true,
                                isPreAllocated: isPrimaryPreAllocated
                            });
                            
                            // Add additional pre-filled guests
                            data.additionalGuests.forEach(name => {
                                const isThisPreAllocated = isPreAllocated(name, data.groupId);
                                initialGuests.push({
                                    name,
                                    attending: isThisPreAllocated ? true : null,
                                    attendanceType: isThisPreAllocated ? 'both' : 'both',
                                    isPrimary: false,
                                    isPreAllocated: isThisPreAllocated
                                });
                            });
                            
                            // Add blank slots
                            const blanksNeeded = data.maxGuests - initialGuests.length;
                            for (let i = 0; i < blanksNeeded; i++) {
                                initialGuests.push({
                                    name: '',
                                    attending: null,
                                    attendanceType: 'both',
                                    isPrimary: false,
                                    isPreAllocated: false
                                });
                            }
                            
                            setGuests(initialGuests);
                            setIsEditing(false);
                        }
                    } catch (err) {
                        const initialGuests = [];
                        
                        const isPrimaryPreAllocated = isPreAllocated(data.primaryGuest, data.groupId);
                        initialGuests.push({
                            name: data.primaryGuest,
                            attending: isPrimaryPreAllocated ? true : null,
                            attendanceType: isPrimaryPreAllocated ? 'both' : 'both',
                            isPrimary: true,
                            isPreAllocated: isPrimaryPreAllocated
                        });
                        
                        data.additionalGuests.forEach(name => {
                            const isThisPreAllocated = isPreAllocated(name, data.groupId);
                            initialGuests.push({
                                name,
                                attending: isThisPreAllocated ? true : null,
                                attendanceType: isThisPreAllocated ? 'both' : 'both',
                                isPrimary: false,
                                isPreAllocated: isThisPreAllocated
                            });
                        });
                        
                        const blanksNeeded = data.maxGuests - initialGuests.length;
                        for (let i = 0; i < blanksNeeded; i++) {
                            initialGuests.push({
                                name: '',
                                attending: null,
                                attendanceType: 'both',
                                isPrimary: false,
                                isPreAllocated: false
                            });
                        }
                        
                        setGuests(initialGuests);
                        setIsEditing(false);
                    }
                    
                    setStage('rsvp');
                    setError('');
                    await calculateWeddingSlots();
                } else {
                    setError('Invalid password. Please check your invitation.');
                }
            };

            const updateGuestName = (index, name) => {
                const updated = [...guests];
                updated[index].name = name;
                setGuests(updated);
            };

            const updateAttendance = (index, attending) => {
                const updated = [...guests];
                updated[index].attending = attending;
                setGuests(updated);
            };

            const updateAttendanceType = (index, type) => {
                const updated = [...guests];
                updated[index].attendanceType = type;
                setGuests(updated);
            };

            const handleSubmit = async () => {
                const filledGuests = guests.filter(g => g.name.trim() !== '');
                const allAnswered = filledGuests.every(g => g.attending !== null);
                
                if (!allAnswered) {
                    setError('Please confirm attendance for all guests listed.');
                    return;
                }

                if (filledGuests.length === 0) {
                    setError('Please add at least one guest name.');
                    return;
                }

               // Check wedding slots
                const newWeddingAttendees = filledGuests.filter(
                    g => g.attending === true && g.attendanceType === 'both' && !g.isPreAllocated
                );
                
                // Calculate current NON-PRE-ALLOCATED slots used (excluding this group's previous RSVP)
                let currentNonPreAllocatedSlots = weddingSlotsFilled - PRE_ALLOCATED_ATTENDEES.length;
                
                if (isEditing) {
                    try {
                        const existing = await window.storage.get(`rsvp:${guestGroup.groupId}`, true);
                        if (existing) {
                            const existingData = JSON.parse(existing.value);
                            const previousWeddingAttendees = existingData.guests.filter(
                                g => g.attending === true && g.attendanceType === 'both' && !g.isPreAllocated
                            ).length;
                            currentNonPreAllocatedSlots -= previousWeddingAttendees;
                        }
                    } catch (err) {
                        // Continue
                    }
                }

                // Check if adding these guests would exceed the 22 available (non-pre-allocated) slots
                const availableSlots = (TOTAL_WEDDING_SLOTS - PRE_ALLOCATED_ATTENDEES.length);
                if (currentNonPreAllocatedSlots + newWeddingAttendees.length > availableSlots) {
                    const remaining = availableSlots - currentNonPreAllocatedSlots;
                    setError(`Only ${remaining} wedding ceremony slot(s) remaining for non-reserved guests. Please select "Reception Only" for some guests.`);
                    return;
                }
                
                if (currentSlots + newWeddingAttendees.length > TOTAL_WEDDING_SLOTS) {
                    const available = TOTAL_WEDDING_SLOTS - currentSlots;
                    setError(`Only ${available} wedding ceremony slot(s) remaining. Please select "Reception Only" for some guests.`);
                    return;
                }

                setLoading(true);
                
                try {
                    const rsvpData = {
                        groupId: guestGroup.groupId,
                        password: password.toUpperCase(),
                        guests: filledGuests,
                        submittedAt: new Date().toISOString()
                    };

                    await window.storage.set(
                        `rsvp:${guestGroup.groupId}`,
                        JSON.stringify(rsvpData),
                        true
                    );

                    setSubmitted(true);
                    setError('');
                    await calculateWeddingSlots();
                } catch (err) {
                    setError('There was an error submitting your RSVP. Please try again.');
                    console.error(err);
                } finally {
                    setLoading(false);
                }
            };

            const availableWeddingSlots = (TOTAL_WEDDING_SLOTS - PRE_ALLOCATED_ATTENDEES.length) - (weddingSlotsFilled - PRE_ALLOCATED_ATTENDEES.length);

            if (submitted) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-amber-50 via-orange-50 to-amber-100 flex items-center justify-center p-4">
                        <div className="max-w-md w-full bg-white rounded-lg shadow-2xl p-8 text-center">
                            <div className="mb-6 flex justify-center">
                                <Heart className="w-16 h-16 text-amber-600" />
                            </div>
                            <h2 className="text-3xl font-serif text-amber-900 mb-4">
                                {isEditing ? 'RSVP Updated!' : 'Thank You!'}
                            </h2>
                            <p className="text-amber-800 mb-6">
                                {isEditing 
                                    ? 'Your RSVP has been successfully updated.'
                                    : 'Your RSVP has been received. We can\'t wait to celebrate with you!'
                                }
                            </p>
                            <div className="space-y-3">
                                <button
                                    onClick={() => {
                                        setStage('password');
                                        setPassword('');
                                        setSubmitted(false);
                                        setGuests([]);
                                        setGuestGroup(null);
                                        setIsEditing(false);
                                    }}
                                    className="w-full bg-amber-600 hover:bg-amber-700 text-white py-3 rounded-lg transition"
                                >
                                    Submit Another RSVP
                                </button>
                                <button
                                    onClick={() => {
                                        setSubmitted(false);
                                        setStage('rsvp');
                                    }}
                                    className="w-full border-2 border-amber-600 text-amber-600 hover:bg-amber-50 py-3 rounded-lg transition"
                                >
                                    Edit This RSVP
                                </button>
                            </div>
                        </div>
                    </div>
                );
            }

            if (stage === 'password') {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-amber-50 via-orange-50 to-amber-100 flex items-center justify-center p-4">
                        <div className="max-w-md w-full bg-white rounded-lg shadow-2xl p-8">
                            <div className="text-center mb-8">
                                <div className="mb-6">
                                    <img 
                                        src={COUPLE_PHOTO_URL} 
                                        alt="Couple" 
                                        className="w-48 h-48 object-cover rounded-full mx-auto shadow-lg border-4 border-amber-200"
                                        onError={(e) => {
                                            e.target.style.display = 'none';
                                            e.target.nextSibling.style.display = 'flex';
                                        }}
                                    />
                                    <div className="w-48 h-48 bg-amber-100 rounded-full mx-auto shadow-lg border-4 border-amber-200 hidden items-center justify-center">
                                        <Heart className="w-16 h-16 text-amber-600" />
                                    </div>
                                </div>
                                
                                <h1 className="text-4xl font-serif text-amber-900 mb-2">You're Invited</h1>
                                <p className="text-amber-700">Please enter your invitation code to RSVP</p>
                            </div>
                            
                            <div>
                                <div className="mb-6">
                                    <label className="block text-amber-800 mb-2 font-medium">
                                        Invitation Code
                                    </label>
                                    <input
                                        type="text"
                                        value={password}
                                        onChange={(e) => setPassword(e.target.value)}
                                        onKeyPress={(e) => e.key === 'Enter' && handlePasswordSubmit()}
                                        className="w-full px-4 py-3 border-2 border-amber-200 rounded-lg focus:outline-none focus:border-amber-400 text-center text-lg tracking-wider uppercase"
                                        placeholder="Enter code"
                                    />
                                </div>
                                
                                {error && (
                                    <div className="mb-4 p-3 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm">
                                        {error}
                                    </div>
                                )}
                                
                                <button
                                    onClick={handlePasswordSubmit}
                                    className="w-full bg-amber-600 hover:bg-amber-700 text-white font-semibold py-3 rounded-lg transition duration-200 shadow-lg"
                                >
                                    Continue
                                </button>
                            </div>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-gradient-to-br from-amber-50 via-orange-50 to-amber-100 flex items-center justify-center p-4 py-8">
                    <div className="max-w-2xl w-full bg-white rounded-lg shadow-2xl p-8">
                        <div className="text-center mb-8">
                            <Heart className="w-12 h-12 text-amber-600 mx-auto mb-4" />
                            <h1 className="text-4xl font-serif text-amber-900 mb-2">RSVP</h1>
                            <p className="text-amber-700">
                                {isEditing 
                                    ? 'Update your RSVP details below'
                                    : 'We\'re excited to celebrate with you!'
                                }
                            </p>
                            {isEditing && (
                                <div className="mt-3 px-4 py-2 bg-blue-50 border border-blue-200 rounded-lg text-blue-800 text-sm inline-block">
                                    You're editing an existing RSVP
                                </div>
                            )}
                            
                            {/* Wedding Slots Counter */}
                            <div className="mt-4 px-4 py-3 bg-amber-50 border-2 border-amber-300 rounded-lg inline-block">
                                <div className="text-sm text-amber-700 font-medium mb-1">Wedding Ceremony Slots</div>
                                <div className="text-2xl font-bold text-amber-900">
                                    {availableWeddingSlots} / {TOTAL_WEDDING_SLOTS - PRE_ALLOCATED_ATTENDEES.length}
                                </div>
                                <div className="text-xs text-amber-600">Available slots remaining</div>
                            </div>
                        </div>

                        <div>
                            <div className="space-y-6 mb-8">
                                {guests.map((guest, index) => (
                                    <div key={index} className="border-2 border-amber-200 rounded-lg p-6 bg-amber-50/50">
                                        <div className="mb-4">
                                            <label className="block text-amber-800 mb-2 font-medium">
                                                {guest.isPrimary ? 'Primary Guest' : `Guest ${index + 1}`}
                                                {guest.isPreAllocated && (
                                                    <span className="ml-2 text-xs bg-green-100 text-green-700 px-2 py-1 rounded">
                                                        Reserved Wedding Spot
                                                    </span>
                                                )}
                                            </label>
                                            <input
                                                type="text"
                                                value={guest.name}
                                                onChange={(e) => updateGuestName(index, e.target.value)}
                                                className="w-full px-4 py-2 border border-amber-300 rounded-lg focus:outline-none focus:border-amber-500"
                                                placeholder="Guest name"
                                                disabled={guest.isPrimary || guest.isPreAllocated}
                                            />
                                        </div>
                                        
                                        {guest.name.trim() && (
                                            <>
                                                {guest.isPreAllocated ? (
                                                    <div className="p-4 bg-green-50 border-2 border-green-200 rounded-lg">
                                                        <div className="flex items-center gap-2 text-green-800">
                                                            <svg className="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                                                <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clipRule="evenodd" />
                                                            </svg>
                                                            <span className="font-semibold">Confirmed for Wedding & Reception</span>
                                                        </div>
                                                        <p className="text-sm text-green-700 mt-2">
                                                            You have a reserved spot for both the wedding ceremony and reception.
                                                        </p>
                                                    </div>
                                                ) : (
                                                    <>
                                                        <div className="mb-4">
                                                            <label className="block text-amber-800 mb-2 font-medium">
                                                                Will you be attending?
                                                            </label>
                                                            <div className="flex gap-3">
                                                                <button
                                                                    type="button"
                                                                    onClick={() => updateAttendance(index, true)}
                                                                    className={`flex-1 py-3 rounded-lg font-semibold transition ${
                                                                        guest.attending === true
                                                                            ? 'bg-green-600 text-white shadow-lg'
                                                                            : 'bg-white border-2 border-amber-300 text-amber-800 hover:border-green-500'
                                                                    }`}
                                                                >
                                                                    Joyfully Accept
                                                                </button>
                                                                <button
                                                                    type="button"
                                                                    onClick={() => updateAttendance(index, false)}
                                                                    className={`flex-1 py-3 rounded-lg font-semibold transition ${
                                                                        guest.attending === false
                                                                            ? 'bg-gray-600 text-white shadow-lg'
                                                                            : 'bg-white border-2 border-amber-300 text-amber-800 hover:border-gray-500'
                                                                    }`}
                                                                >
                                                                    Regretfully Decline
                                                                </button>
                                                            </div>
                                                        </div>

                                                        {guest.attending === true && (
                                                            <div>
                                                                <label className="block text-amber-800 mb-2 font-medium">
                                                                    Which event(s) will you attend?
                                                                </label>
                                                                <select
                                                                    value={guest.attendanceType}
                                                                    onChange={(e) => updateAttendanceType(index, e.target.value)}
                                                                    className="w-full px-4 py-3 border-2 border-amber-300 rounded-lg focus:outline-none focus:border-amber-500 bg-white text-amber-900"
                                                                >
                                                                    <option value="both">
                                                                        Wedding & Reception {availableWeddingSlots === 0 && guest.attendanceType !== 'both' ? '(FULL)' : ''}
                                                                    </option>
                                                                    <option value="reception">Reception Only</option>
                                                                </select>
                                                                {guest.attendanceType === 'both' && availableWeddingSlots <= 5 && (
                                                                    <p className="text-sm text-orange-600 mt-2">
                                                                        ⚠️ Only {availableWeddingSlots} ceremony slot{availableWeddingSlots !== 1 ? 's' : ''} remaining
                                                                    </p>
                                                                )}
                                                            </div>
                                                        )}
                                                    </>
                                                )}
                                            </>
                                        )}
                                    </div>
                                ))}
                            </div>

                            {error && (
                                <div className="mb-4 p-3 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm">
                                    {error}
                                </div>
                            )}

                            <button
                                onClick={handleSubmit}
                                disabled={loading}
                                className="w-full bg-amber-600 hover:bg-amber-700 text-white font-semibold py-4 rounded-lg transition duration-200 shadow-lg disabled:opacity-50"
                            >
                                {loading ? 'Submitting...' : isEditing ? 'Update RSVP' : 'Submit RSVP'}
                            </button>
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<WeddingRSVP />, document.getElementById('root'));
    </script>
</body>
</html>
